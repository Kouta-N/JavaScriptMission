<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>JavaScriptMission3-2</title>
</head>

<body>

  <h1>ToDoリスト</h1>
  <form>
    <input type="radio" id="all">すべて
    <input type="radio" id="doing">作業中
    <input type="radio" id="fin">完了
  </form>

<table id="todo">
    <tr class="table_header">
      <td>ID</td>
      <td>コメント</td>
      <td>状態</td>
    </tr>
</table>

  <h2>新規タスクの追加</h2>

  <form>
    <input type="text" id="new_task">
    <input type="button" id="add" value="追加">
  </form>

<script>
  
let id_num = 1;//IDの添字 テーブルのIDに使用するので初期値は1にする
let sta_id = 0;//作業中、削除のボタンを追加するためのID

// ToDoリストテーブル要素の追加作業を関数化 //
function outputTable(index,button_id){
 const add_table = document.getElementById('todo');
 const row = add_table.insertRow(-1);//引数の-1は最後の列を指定できる
 const index_cell = row.insertCell(0);
 const comment_cell = row.insertCell(1);
 const sta_cell = row.insertCell(2);
 sta_cell.setAttribute('id','sta' + `${button_id}`);//作業中、削除のボタンをappendChildするためのIDを作成

 // ID出力 //
 index_cell.innerHTML = index;

 // コメント出力 //
 const comment_text = document.getElementById('new_task').value;
 comment_cell.innerHTML = comment_text;
 new_task.value = ''; //コメント入力フォームの初期化

 // ボタン出力 //
 const status_button = document.createElement('button');
 status_button.innerHTML = '作業中';
 const add_button_id = document.getElementById('sta' + `${button_id}`);
 add_button_id.appendChild(status_button);

 const delete_button = document.createElement('button');
 delete_button.innerHTML = '削除';
 add_button_id.appendChild(delete_button);

 delete_button.addEventListener('click', () => removeTask(delete_button,index));

 // 要素数の調整 //
 id_num++;//ToDoリストを1つ追加したため、IDの要素数を+1
 sta_id++;//作業中、削除ボタンを追加したため、ボタンIDの要素数を+1
}


//ボタンによるタスクの削除を関数化
const removeTask = (delete_button , index) => {
const delete_table = document.getElementById('todo');
delete_table.deleteRow(index);

  // IDのふり直し //
  for(let row_num = index; row_num < delete_table.rows.length; row_num++){
    delete_table.rows[row_num].cells[0].innerHTML = row_num;
  }

id_num --;//ToDoリストを1つ削除したため、IDの要素数を-1
};

// タスクの出力処理(本文) //
const onclick = document.getElementById('add');
onclick.addEventListener('click', function (){
outputTable(id_num,sta_id);
});

</script>

<style>
  .table_header{
    text-align: center;
  }
</style>

</body>
</html>